/* [create-plugin] version: 5.25.1 */
define(["module","@grafana/ui","react","@grafana/data","@grafana/runtime"],(e,t,r,n,o)=>(()=>{var a={41:e=>{e.exports=function(e){return function(t){return e(t)}}},492:(e,t,r)=>{e=r.nmd(e);var n=r(1433),o=r(659),a=t&&!t.nodeType&&t,i=a&&e&&!e.nodeType&&e,s=i&&i.exports===a?n.Buffer:void 0,l=(s?s.isBuffer:void 0)||o;e.exports=l},659:e=>{e.exports=function(){return!1}},1163:(e,t,r)=>{var n=r(6204),o=r(1256),a=r(6397),i=r(492),s=r(2845),l=r(7995),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=a(e),u=!r&&o(e),p=!r&&!u&&i(e),f=!r&&!u&&!p&&l(e),h=r||u||p||f,m=h?n(e.length,String):[],d=m.length;for(var y in e)!t&&!c.call(e,y)||h&&("length"==y||p&&("offset"==y||"parent"==y)||f&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||s(y,d))||m.push(y);return m}},1256:(e,t,r)=>{var n=r(9250),o=r(2934),a=Object.prototype,i=a.hasOwnProperty,s=a.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(e){return o(e)&&i.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},1308:t=>{"use strict";t.exports=e},1433:(e,t,r)=>{var n=r(5380),o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")();e.exports=a},1485:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},1491:(e,t,r)=>{var n=r(8953),o=r(7499),a=r(8201),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return a(e);var t=o(e),r=[];for(var s in e)("constructor"!=s||!t&&i.call(e,s))&&r.push(s);return r}},1506:(e,t,r)=>{var n=r(4796),o=r(5265),a=r(6805);e.exports=function(e,t){return a(o(e,t,n),e+"")}},1738:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},2007:e=>{"use strict";e.exports=t},2781:(e,t,r)=>{var n=r(1433).Symbol;e.exports=n},2845:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},2934:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},3122:e=>{e.exports=function(e){return function(){return e}}},3330:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},3685:(e,t,r)=>{e=r.nmd(e);var n=r(5380),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,i=a&&a.exports===o&&n.process,s=function(){try{var e=a&&a.require&&a.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=s},3936:(e,t,r)=>{var n=r(1506),o=r(9316),a=r(6220),i=r(5405),s=Object.prototype,l=s.hasOwnProperty,c=n(function(e,t){e=Object(e);var r=-1,n=t.length,c=n>2?t[2]:void 0;for(c&&a(t[0],t[1],c)&&(n=1);++r<n;)for(var u=t[r],p=i(u),f=-1,h=p.length;++f<h;){var m=p[f],d=e[m];(void 0===d||o(d,s[m])&&!l.call(e,m))&&(e[m]=u[m])}return e});e.exports=c},3983:e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var o=t(),a=16-(o-n);if(n=o,a>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},4796:e=>{e.exports=function(e){return e}},5265:(e,t,r)=>{var n=r(6701),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var a=arguments,i=-1,s=o(a.length-t,0),l=Array(s);++i<s;)l[i]=a[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=a[i];return c[t]=r(l),n(e,this,c)}}},5380:(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},5405:(e,t,r)=>{var n=r(1163),o=r(1491),a=r(8330);e.exports=function(e){return a(e)?n(e,!0):o(e)}},5959:e=>{"use strict";e.exports=r},6204:e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},6220:(e,t,r)=>{var n=r(9316),o=r(8330),a=r(2845),i=r(8953);e.exports=function(e,t,r){if(!i(r))return!1;var s=typeof t;return!!("number"==s?o(r)&&a(t,r.length):"string"==s&&t in r)&&n(r[t],e)}},6397:e=>{var t=Array.isArray;e.exports=t},6567:(e,t,r)=>{var n=r(8446),o=r(8092),a=r(8953),i=r(1485),s=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,u=l.toString,p=c.hasOwnProperty,f=RegExp("^"+u.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(n(e)?f:s).test(i(e))}},6701:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},6772:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},6805:(e,t,r)=>{var n=r(7310),o=r(3983)(n);e.exports=o},7129:(e,t,r)=>{var n=r(7148),o=r(3330),a=r(2934),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[n(e)]}},7148:(e,t,r)=>{var n=r(2781),o=r(7903),a=r(1738),i=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):a(e)}},7310:(e,t,r)=>{var n=r(3122),o=r(8559),a=r(4796),i=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:a;e.exports=i},7499:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},7781:e=>{"use strict";e.exports=n},7903:(e,t,r)=>{var n=r(2781),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var o=i.call(e);return n&&(t?e[s]=r:delete e[s]),o}},7995:(e,t,r)=>{var n=r(7129),o=r(41),a=r(3685),i=a&&a.isTypedArray,s=i?o(i):n;e.exports=s},8092:(e,t,r)=>{var n,o=r(8109),a=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!a&&a in e}},8109:(e,t,r)=>{var n=r(1433)["__core-js_shared__"];e.exports=n},8201:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},8330:(e,t,r)=>{var n=r(8446),o=r(3330);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},8446:(e,t,r)=>{var n=r(7148),o=r(8953);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},8531:e=>{"use strict";e.exports=o},8559:(e,t,r)=>{var n=r(9138),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},8953:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},9138:(e,t,r)=>{var n=r(6567),o=r(6772);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},9250:(e,t,r)=>{var n=r(7148),o=r(2934);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},9316:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={id:e,loaded:!1,exports:{}};return a[e](r,r.exports,s),r.loaded=!0,r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.p="public/plugins/frser-sqlite-datasource/";var l={};return(()=>{"use strict";s.r(l),s.d(l,{plugin:()=>w});var e=s(1308),t=s.n(e);s.p=t()&&t().uri?t().uri.slice(0,t().uri.lastIndexOf("/")+1):"public/plugins/frser-sqlite-datasource/";var r=s(7781),n=s(8531);function o(e,t,r,n,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}class a extends n.DataSourceWithBackend{applyTemplateVariables(e,t){return e.queryText=this.templateSrv.replace(e.rawQueryText,t),e}metricFindQuery(e,t){return(r=function*(){if(!e)return[];const t=yield this.query({targets:[{refId:"metricFindQuery",rawQueryText:e,queryText:e,timeColumns:[]}]}).toPromise();if(void 0===t)throw new Error("Received no response at all");if(t.error)throw new Error(t.error.message);const r=t.data[0];if(1===r.fields.length)return r.fields[0].values.toArray().map(e=>({text:e}));if(2===r.fields.length){const e=r.fields.findIndex(e=>"__text"===e.name),t=r.fields.findIndex(e=>"__value"===e.name);if(-1===e||-1===t)throw new Error(`No columns named "__text" and "__value" were found. Columns: ${r.fields.map(e=>e.name).join(",")}`);const n=r.fields[t].values.toArray();return r.fields[e].values.toArray().map((e,t)=>({text:e,value:n[t]}))}throw new Error(`Received more than two (${r.fields.length}) fields: ${r.fields.map(e=>e.name).join(",")}`)},function(){var e=this,t=arguments;return new Promise(function(n,a){var i=r.apply(e,t);function s(e){o(i,n,a,s,l,"next",e)}function l(e){o(i,n,a,s,l,"throw",e)}s(void 0)})}).call(this);var r}constructor(e){var t,r,o;super(e),o=void 0,(r="templateSrv")in(t=this)?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,this.templateSrv=(0,n.getTemplateSrv)(),this.annotations={}}}var i=s(5959),c=s.n(i),u=s(2007);function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){p(e,t,r[t])})}return e}function h(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}const{FormField:m}=u.LegacyForms;class d extends i.PureComponent{render(){const{options:e,onOptionsChange:t}=this.props,{jsonData:r,secureJsonFields:n,secureJsonData:o}=e;return void 0===r.pathPrefix&&t(h(f({},e),{jsonData:h(f({},e.jsonData),{pathPrefix:"file:"})})),void 0===r.attachLimit&&t(h(f({},e),{jsonData:h(f({},e.jsonData),{attachLimit:0})})),c().createElement("div",{className:"gf-form-group"},c().createElement("div",{className:"gf-form"},c().createElement(m,{label:"Path",tooltip:"(absolute) path to the SQLite database file",labelWidth:10,inputWidth:20,onChange:this.onPathChange,value:r.path,placeholder:"/path/to/the/database.db"})),c().createElement("div",{className:"gf-form"},c().createElement(m,{label:"Path Prefix",tooltip:'This string is prefixed before the path in the connection string. Unless you know what you are doing this should be "file:" (without the quotes). Not using "file:" can cause the Path Options to not take effect.',labelWidth:10,inputWidth:20,onChange:this.onPathPrefixChange,value:r.pathPrefix})),c().createElement("div",{className:"gf-form"},c().createElement(m,{label:"Path Options",tooltip:'This string is appended to the path (after adding a "?") when opening the database. A typical example is "mode=ro" (without the quotes) for readonly mode.',labelWidth:10,inputWidth:20,onChange:this.onPathOptionsChange,value:r.pathOptions,placeholder:"mode=ro&_ignore_check_constraints=1"})),c().createElement("div",{className:"gf-form"},c().createElement(m,{label:"Secure Path Options",tooltip:"This is combined with the regular path options. Typical for the secure options are credentials (options starting with _auth).",labelWidth:10,inputWidth:20,placeholder:(null==n?void 0:n.securePathOptions)?"configured":"",value:null==o?void 0:o.securePathOptions,onChange:this.onSecurePathOptionsChange})),c().createElement("div",{className:"gf-form"},c().createElement(m,{label:"Attach limit",tooltip:"The runtime limit for attached databases (see: https://www.sqlite.org/limits.html).",labelWidth:10,inputWidth:20,value:r.attachLimit,onChange:this.onAttachLimitChange})),c().createElement("div",{className:"gf-form"},c().createElement(u.Alert,{title:"File System Permissions",severity:"info"},c().createElement("div",null,"The plugin runs with the same permissions as the Grafana user. Any file that can be opened with the Grafana user can be opened with the SQLite plugin."),c().createElement("div",null,'Beware that by enabling attaching databases (setting an "attach limit" above 0) you enable any user with access to the plugin to attach any database that the Grafana user has access to.'),c().createElement("div",null,'It is the most secure (and recommended) approach to set the "attach limit" to 0.'))))}constructor(...e){super(...e),p(this,"onPathPrefixChange",e=>{const{onOptionsChange:t,options:r}=this.props,n=h(f({},r.jsonData),{pathPrefix:e.target.value});t(h(f({},r),{jsonData:n}))}),p(this,"onPathOptionsChange",e=>{const{onOptionsChange:t,options:r}=this.props,n=h(f({},r.jsonData),{pathOptions:e.target.value});t(h(f({},r),{jsonData:n}))}),p(this,"onSecurePathOptionsChange",e=>{const{onOptionsChange:t,options:r}=this.props;t(h(f({},r),{secureJsonData:{securePathOptions:e.target.value}}))}),p(this,"onPathChange",e=>{const{onOptionsChange:t,options:r}=this.props,n=h(f({},r.jsonData),{path:e.target.value});t(h(f({},r),{jsonData:n}))}),p(this,"onAttachLimitChange",e=>{let t;if(""!==e.target.value&&(t=parseInt(e.target.value,10),Number.isNaN(t)))return;const{onOptionsChange:r,options:n}=this.props,o=h(f({},n.jsonData),{attachLimit:t});r(h(f({},n),{jsonData:o}))})}}var y=s(3936),b=s.n(y);const g={rawQueryText:"SELECT CAST(strftime('%s', 'now', '-1 minute') as INTEGER) as time, 4 as value \nWHERE time >= $__from / 1000 and time < $__to / 1000",queryText:"\n    SELECT CAST(strftime('%s', 'now', '-1 minute') as INTEGER) as time, 4 as value\n    WHERE time >= 1234 and time < 134567\n  ",timeColumns:["time","ts"],queryType:"table"};function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){v(e,t,r[t])})}return e}function O(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function x(e){let t=20*e.split("\n").length;return Math.min(500,Math.max(200,t))}const w=new r.DataSourcePlugin(a).setConfigEditor(d).setQueryEditor(function(e){function t(t){const{onChange:r,query:n}=e;r(O(j({},n),{rawQueryText:t,queryText:t})),e.onRunQuery()}const r=b()(e.query,g),{rawQueryText:n,timeColumns:o}=r,[a,s]=(0,i.useState)(!1),[l,p]=(0,i.useState)(!1),f=[{label:"Table",value:"table"},{label:"Time series",value:"time series"}],h=f.find(e=>e.value===r.queryType)||f[0];return c().createElement(c().Fragment,null,l?c().createElement("div",{className:"gf-form"},c().createElement(u.TextArea,{style:{height:100},role:"query-editor-input",value:n,onBlur:()=>e.onRunQuery(),onChange:e=>t(e.target.value)})):c().createElement(u.CodeEditor,{height:x(n),value:n,onBlur:t,onSave:t,language:"sql",showMiniMap:!1}),c().createElement("div",{className:"gf-form-inline"},c().createElement("div",{className:"gf-form",role:"query-type-container",style:{marginRight:15}},c().createElement(u.InlineFormLabel,null,c().createElement("div",{style:{whiteSpace:"nowrap"}},"Format as:")),c().createElement(u.Select,{allowCustomValue:!1,isSearchable:!1,onChange:function(t){const{onChange:r,query:n}=e;r(O(j({},n),{queryType:t.value||"table"})),e.onRunQuery()},options:f,value:h})),c().createElement("div",{className:"gf-form"},c().createElement("div",{style:{display:"flex",flexDirection:"row",marginRight:15},role:"time-column-selector"},c().createElement(u.InlineFormLabel,null,c().createElement("div",{style:{whiteSpace:"nowrap"},onClick:()=>s(!a)},"Time formatted columns ",c().createElement(u.Icon,{name:a?"angle-down":"angle-right"}))),c().createElement(u.TagsInput,{onChange:t=>function(t,r){const{onChange:n,query:o}=e;n(O(j({},o),{[t]:r})),e.onRunQuery()}("timeColumns",t),tags:o})),c().createElement("div",{className:"gf-form",style:{alignItems:"center"}},c().createElement(u.InlineFormLabel,null,c().createElement("div",{style:{whiteSpace:"nowrap"}},"Use legacy code editor:")),c().createElement(u.Switch,{role:"use-legacy-editor-switch",value:l,onChange:()=>p(!l)})))),a&&c().createElement(u.Alert,{title:"Time formatted columns",severity:"info"},'Columns with these names, will be formatted as time. This is required as SQLite has no native "time" format, but mostly strings and numbers. See:'," ",c().createElement("a",{href:"https://www.sqlite.org/datatype3.html",target:"_blank",rel:"noreferrer"},"SQLite3 Data Types Documentation"),c().createElement("br",null),"For more information (like supported formats) see:"," ",c().createElement("a",{href:"https://github.com/fr-ser/grafana-sqlite-datasource#support-for-time-formatted-columns",target:"_blank",rel:"noreferrer"},"Plugin documentation")))})})(),l})());
//# sourceMappingURL=module.js.map